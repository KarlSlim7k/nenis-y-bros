<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Debug - Autenticaci√≥n Admin</title>
    <style>
        body {
            font-family: 'Courier New', monospace;
            max-width: 900px;
            margin: 30px auto;
            padding: 20px;
            background: #1e1e1e;
            color: #d4d4d4;
        }
        h1 { color: #4ec9b0; margin-bottom: 30px; }
        .section {
            background: #252526;
            padding: 20px;
            border-radius: 8px;
            margin-bottom: 20px;
            border-left: 4px solid #007acc;
        }
        .section h2 { 
            color: #569cd6; 
            margin-top: 0;
            font-size: 1.2rem;
        }
        .info-row {
            display: grid;
            grid-template-columns: 200px 1fr;
            gap: 10px;
            padding: 8px 0;
            border-bottom: 1px solid #3e3e42;
        }
        .info-row:last-child { border-bottom: none; }
        .label { color: #9cdcfe; font-weight: bold; }
        .value { color: #ce9178; }
        .value.success { color: #4ec9b0; }
        .value.error { color: #f48771; }
        .btn {
            background: #0e639c;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 4px;
            cursor: pointer;
            margin-right: 10px;
            margin-top: 10px;
        }
        .btn:hover { background: #1177bb; }
        .btn-danger { background: #c5282a; }
        .btn-danger:hover { background: #e81123; }
        .btn-success { background: #107c10; }
        .btn-success:hover { background: #0f7b0f; }
        pre {
            background: #1e1e1e;
            padding: 15px;
            border-radius: 4px;
            overflow-x: auto;
            color: #d4d4d4;
        }
        .status {
            display: inline-block;
            padding: 4px 12px;
            border-radius: 12px;
            font-size: 0.9rem;
            font-weight: bold;
        }
        .status.ok { background: #107c10; color: white; }
        .status.error { background: #c5282a; color: white; }
        .status.warning { background: #ca5010; color: white; }
    </style>
</head>
<body>
    <h1>üîç Debug - Autenticaci√≥n del Panel Admin</h1>

    <div class="section">
        <h2>Estado de la Sesi√≥n</h2>
        <div id="sessionStatus"></div>
    </div>

    <div class="section">
        <h2>LocalStorage - Token</h2>
        <div id="tokenInfo"></div>
    </div>

    <div class="section">
        <h2>LocalStorage - Usuario</h2>
        <div id="userInfo"></div>
    </div>

    <div class="section">
        <h2>Verificaciones de Rol</h2>
        <div id="roleChecks"></div>
    </div>

    <div class="section">
        <h2>Rutas Configuradas</h2>
        <div id="routesInfo"></div>
    </div>

    <div class="section">
        <h2>Acciones de Debug</h2>
        <button class="btn btn-success" onclick="createAdminSession()">‚úÖ Crear Sesi√≥n Admin</button>
        <button class="btn btn-danger" onclick="clearSession()">üóëÔ∏è Limpiar Sesi√≥n</button>
        <button class="btn" onclick="testAdminAccess()">üîê Probar Acceso Admin</button>
        <button class="btn" onclick="location.reload()">üîÑ Recargar</button>
    </div>

    <script src="../../assets/js/config.js"></script>
    <script src="../../assets/js/auth.js"></script>
    <script>
        function displayStatus() {
            // Estado de la sesi√≥n
            const isAuth = isAuthenticated();
            const token = getAuthToken();
            const user = getAuthUser();
            const userIsAdmin = isAdmin();

            document.getElementById('sessionStatus').innerHTML = `
                <div class="info-row">
                    <div class="label">Estado:</div>
                    <div class="value ${isAuth ? 'success' : 'error'}">
                        <span class="status ${isAuth ? 'ok' : 'error'}">
                            ${isAuth ? '‚úÖ Autenticado' : '‚ùå No Autenticado'}
                        </span>
                    </div>
                </div>
                <div class="info-row">
                    <div class="label">Es Administrador:</div>
                    <div class="value ${userIsAdmin ? 'success' : 'error'}">
                        <span class="status ${userIsAdmin ? 'ok' : 'error'}">
                            ${userIsAdmin ? '‚úÖ S√ç' : '‚ùå NO'}
                        </span>
                    </div>
                </div>
            `;

            // Token info
            document.getElementById('tokenInfo').innerHTML = `
                <div class="info-row">
                    <div class="label">Key Storage:</div>
                    <div class="value">${AUTH_TOKEN_KEY}</div>
                </div>
                <div class="info-row">
                    <div class="label">Token Presente:</div>
                    <div class="value ${token ? 'success' : 'error'}">
                        ${token ? '‚úÖ S√≠' : '‚ùå No'}
                    </div>
                </div>
                <div class="info-row">
                    <div class="label">Token:</div>
                    <div class="value">${token ? token.substring(0, 50) + '...' : 'No hay token'}</div>
                </div>
            `;

            // User info
            if (user) {
                document.getElementById('userInfo').innerHTML = `
                    <div class="info-row">
                        <div class="label">Key Storage:</div>
                        <div class="value">${AUTH_USER_KEY}</div>
                    </div>
                    <div class="info-row">
                        <div class="label">ID:</div>
                        <div class="value success">${user.id || 'N/A'}</div>
                    </div>
                    <div class="info-row">
                        <div class="label">Email:</div>
                        <div class="value success">${user.email || 'N/A'}</div>
                    </div>
                    <div class="info-row">
                        <div class="label">Nombre:</div>
                        <div class="value success">${user.nombre || 'N/A'} ${user.apellido || ''}</div>
                    </div>
                    <div class="info-row">
                        <div class="label">tipo_usuario:</div>
                        <div class="value ${user.tipo_usuario === 'administrador' ? 'success' : 'error'}">
                            <strong>${user.tipo_usuario || 'N/A'}</strong>
                        </div>
                    </div>
                    <div class="info-row">
                        <div class="label">JSON Completo:</div>
                        <div class="value"><pre>${JSON.stringify(user, null, 2)}</pre></div>
                    </div>
                `;
            } else {
                document.getElementById('userInfo').innerHTML = `
                    <div class="info-row">
                        <div class="label">Estado:</div>
                        <div class="value error">‚ùå No hay datos de usuario en localStorage</div>
                    </div>
                `;
            }

            // Role checks
            document.getElementById('roleChecks').innerHTML = `
                <div class="info-row">
                    <div class="label">isAdmin():</div>
                    <div class="value ${isAdmin() ? 'success' : 'error'}">${isAdmin() ? '‚úÖ true' : '‚ùå false'}</div>
                </div>
                <div class="info-row">
                    <div class="label">isMentor():</div>
                    <div class="value">${isMentor() ? '‚úÖ true' : '‚ùå false'}</div>
                </div>
                <div class="info-row">
                    <div class="label">isEmpresario():</div>
                    <div class="value">${isEmpresario() ? '‚úÖ true' : '‚ùå false'}</div>
                </div>
                <div class="info-row">
                    <div class="label">isEmprendedor():</div>
                    <div class="value">${isEmprendedor() ? '‚úÖ true' : '‚ùå false'}</div>
                </div>
                <div class="info-row">
                    <div class="label">getUserType():</div>
                    <div class="value success">${getUserType() || 'null'}</div>
                </div>
                <div class="info-row">
                    <div class="label">getUserTypeName():</div>
                    <div class="value success">${getUserTypeName() || 'null'}</div>
                </div>
            `;

            // Routes
            document.getElementById('routesInfo').innerHTML = `
                <div class="info-row">
                    <div class="label">ROUTES.login:</div>
                    <div class="value">${ROUTES.login}</div>
                </div>
                <div class="info-row">
                    <div class="label">ROUTES.adminDashboard:</div>
                    <div class="value">${ROUTES.adminDashboard}</div>
                </div>
                <div class="info-row">
                    <div class="label">ROUTES.diagnosticos:</div>
                    <div class="value">${ROUTES.diagnosticos}</div>
                </div>
                <div class="info-row">
                    <div class="label">URL Actual:</div>
                    <div class="value">${window.location.pathname}</div>
                </div>
            `;
        }

        function createAdminSession() {
            const adminUser = {
                id: 19,
                email: 'admin@test.com',
                nombre: 'Administrador',
                apellido: 'Sistema',
                tipo_usuario: 'administrador',
                estado: 'activo'
            };
            const fakeToken = 'fake_jwt_token_' + Date.now();
            
            setAuthToken(fakeToken);
            setAuthUser(adminUser);
            
            alert('‚úÖ Sesi√≥n de administrador creada.\nToken: ' + fakeToken.substring(0, 30) + '...');
            displayStatus();
        }

        function clearSession() {
            clearAuth();
            alert('üóëÔ∏è Sesi√≥n limpiada');
            displayStatus();
        }

        function testAdminAccess() {
            const user = getAuthUser();
            
            console.group('üß™ TEST DE ACCESO ADMIN');
            console.log('1. isAuthenticated():', isAuthenticated());
            console.log('2. getAuthUser():', user);
            console.log('3. user.tipo_usuario:', user ? user.tipo_usuario : null);
            console.log('4. isAdmin():', isAdmin());
            
            if (!isAuthenticated()) {
                console.error('‚ùå FALLO: No est√° autenticado');
                alert('‚ùå FALLO: No est√° autenticado\nSer√≠as redirigido a: ' + ROUTES.login);
            } else if (!isAdmin()) {
                console.error('‚ùå FALLO: No es administrador');
                alert('‚ùå FALLO: No es administrador\nSer√≠as redirigido a: ' + ROUTES.diagnosticos);
            } else {
                console.log('‚úÖ √âXITO: Acceso permitido');
                alert('‚úÖ √âXITO: Acceso permitido al panel admin\nPuedes navegar a: ' + ROUTES.adminDashboard);
            }
            console.groupEnd();
        }

        // Cargar al inicio
        displayStatus();
    </script>
</body>
</html>
